<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Pembayaran QRIS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container card" id="paymentContainer">
    <h1>Pembayaran QRIS</h1>
    <p id="info"></p>

    <!-- Ganti URL gambar QR di bawah ini dengan QRIS kamu -->
    <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://get-qr.com/h-0PUe123&size=250x250"
         alt="QRIS" style="border-radius:10px;">

    <p>Scan QRIS di atas menggunakan aplikasi DANA / OVO / GoPay / ShopeePay</p>

    <p class="status" id="status">‚è≥ Menunggu pembayaran...</p>

    <div id="actionButtons" class="hidden" style="margin-top:15px;">
      <button class="btn" style="background:#16a34a;" onclick="successPayment()">‚úÖ Simulasi Berhasil</button>
      <button class="btn" style="background:#dc2626;" onclick="failPayment()">‚ùå Simulasi Gagal</button>
    </div>
  </div>

  <script>
    // Ambil token & data order
    const params = new URLSearchParams(window.location.search);
    const token = params.get('order');
    const data = JSON.parse(localStorage.getItem('orderData') || 'null');

    // Cegah akses langsung
    if (!data || data.token !== token) {
      alert('Tidak ada pesanan aktif. Silakan pesan dulu.');
      window.location.href = 'index.html';
    }

    // Tampilkan info transaksi
    document.getElementById('info').innerText =
      `${data.nama} membeli ${data.namaItem} seharga Rp${data.harga}`;

    // Simulasi setelah 5 detik: QR discan
    setTimeout(() => {
      document.getElementById('status').innerText = 'üîç QR terdeteksi, menunggu konfirmasi...';
      document.getElementById('actionButtons').classList.remove('hidden');
    }, 5000);

    // Tombol Payment Success
    async function successPayment() {
      document.getElementById('status').innerText = '‚úÖ Pembayaran Berhasil!';
      await kirimDiscord("Payment Success", 0x22C55E);
      setTimeout(() => window.location.href = 'success.html', 2000);
    }

    // Tombol Payment Failed
    async function failPayment() {
      document.getElementById('status').innerText = '‚ùå Pembayaran Gagal';
      await kirimDiscord("Payment Failed", 0xDC2626);
      setTimeout(() => window.location.href = 'fail.html', 2500);
    }

    // Kirim notifikasi ke Discord
    async function kirimDiscord(status, color) {
      const webhook = "DISCORD_WEBHOOK_URL_KAMU";
      await fetch(webhook, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          username: "Toko Bot",
          embeds: [{
            title: status,
            color: color,
            fields: [
              { name: "Nama Pembeli", value: data.nama },
              { name: "Item", value: data.namaItem },
              { name: "Jumlah", value: `Rp${data.harga}` },
              { name: "Status", value: status }
            ],
            timestamp: new Date()
          }]
        })
      });
    }
  </script>
</body>
</html>
